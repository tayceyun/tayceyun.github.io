# 投资分析工具

综合投资分析工具，包含 ETF 定投分析和个股加权评分系统。

## 功能特点

### ETF 定投分析
- **多维度目标价计算**：综合短期(MA20)、中期(MA60)、长期(月K低点)三个维度
- **智能买入建议**：根据RSI、均线位置、月涨跌幅、溢价率综合判断
- **4只ETF覆盖**：纳指100、标普500、沪深300、科创50

### 个股加权评分分析
- **9维度加权评分**：均线、RSI、成交量、MACD、布林带等
- **智能做T建议**：基于综合评分给出加仓/减仓建议
- **核心+机动仓位**：区分长期持有和短期操作
- **覆盖股票**：铜陵有色(000630)、紫金矿业(601899)

## 安装

```bash
cd ~/Documents/tayceyun.github.io/etf-investment-tool
pip install -r requirements.txt
```

## 使用

### 一键运行（推荐）

```bash
./run.sh
```

同时输出 ETF 分析和个股分析结果。

### 单独运行

```bash
# 仅 ETF 分析
python etf_analyzer.py

# 仅个股分析
python stock_analyzer.py
```

## 输出示例

```
╭─────────────────────────────────────────────────────────────────────────────╮
│               ETF投资目标价格分析 (多维度版)                                   │
│               分析时间: 2024-01-15 09:30:00                                  │
╰─────────────────────────────────────────────────────────────────────────────╯

╭──────────┬────────┬────────┬────────┬────────┬──────┬────────┬────────┬────────┬───────────────╮
│ ETF      │ 现价   │ MA20   │ MA60   │ 月K低  │ RSI  │ 月涨跌 │ 目标价 │ 单次金额│ 建议          │
├──────────┼────────┼────────┼────────┼────────┼──────┼────────┼────────┼────────┼───────────────┤
│ 纳指100  │ 2.150  │ 2.200  │ 2.180  │ 2.050  │ 45   │ -2.5%  │ 2.100  │ ¥1000  │ 正常买入      │
│ 标普500  │ 1.580  │ 1.550  │ 1.520  │ 1.480  │ 52   │ +1.2%  │ 1.450  │ ¥500   │ 暂缓买入      │
│ 沪深300  │ 3.850  │ 3.900  │ 4.000  │ 3.700  │ 38   │ -3.8%  │ 3.750  │ ¥500   │ 减半买入      │
│ 科创50   │ 0.920  │ 1.050  │ 1.100  │ 0.900  │ 28   │ -12.5% │ 0.980  │ ¥500   │ 强烈买入[可加仓]│
╰──────────┴────────┴────────┴────────┴────────┴──────┴────────┴────────┴────────┴───────────────╯
```

## 算法说明

### 目标价格计算

```
目标价 = 基准价 × (1 - 折扣率)

基准价 = MA20 × 40% + MA60 × 40% + 月K低点 × 20%
```

### 折扣率确定

| RSI范围 | 基础折扣 | 说明 |
|---------|----------|------|
| RSI < 30 | 2% | 超卖区域 |
| RSI < 50 | 4% | 偏弱区域 |
| RSI ≥ 50 | 6% | 正常或偏强 |

### 信号加成

每满足以下条件之一，折扣率减少1%（更容易触发买入）：
- 现价 < MA20（短期低估）
- 现价 < MA60（中期低估）
- 现价接近月K低点±5%（接近底部）

### 溢价率调整（差异化阈值）

| ETF类型 | 阈值 | 说明 |
|---------|------|------|
| 美股QDII（纳指、标普） | 4% | QDII额度限制，常年有溢价 |
| A股ETF（沪深300、科创50） | 0% | 套利机制完善，溢价应接近0 |

**溢价率对折扣的影响**：
```
溢价调整 = (实际溢价率 - 阈值) × 0.5%
```
- 溢价超过阈值 → 增加折扣要求（提高买入门槛）
- 折价 → 减少折扣要求（降低买入门槛）

**溢价状态**：
| 状态 | 条件 | 建议调整 |
|------|------|----------|
| 🟢 折价 | 溢价率 < 0% | 建议升级一档 |
| ⚪ 正常 | 溢价率 ≤ 阈值 | 不调整 |
| 🟡 偏高 | 溢价率 > 阈值+2% | 警告 |
| 🔴 过高 | 溢价率 > 阈值+4% | 建议降级一档 |

### 买入建议

| 条件 | 建议 |
|------|------|
| 现价 ≤ 目标价 且 信号≥2 | 强烈买入 |
| 现价 ≤ 目标价 | 正常买入 |
| 现价 ≤ 目标价×1.05 | 减半买入 |
| 现价 > 目标价×1.05 | 暂缓买入 |
| 月跌幅 > 10% | 追加"可加仓"标记 |

## 定投计划

| ETF | 频率 | 单次金额 | 月投总额 |
|-----|------|----------|----------|
| 纳指100ETF | 每月2次 | ¥1000 | ¥2000 |
| 标普500ETF | 每月2次 | ¥500 | ¥1000 |
| 沪深300ETF | 每月2次 | ¥500 | ¥1000 |
| 科创50ETF | 每月2次 | ¥500 | ¥1000 |
| **合计** | **每月8次** | - | **¥5000** |

## 个股加权评分系统

### 9维度权重分配

| 维度 | 权重 | 说明 |
|------|------|------|
| 均线系统 | 25% | MA5/MA30/MA60位置关系 |
| RSI指标 | 15% | 超买超卖判断 |
| 成交量 | 15% | 量价配合分析 |
| 成本关系 | 12% | 与持仓成本的盈亏 |
| MACD | 10% | 金叉死叉判断 |
| 涨跌幅 | 10% | 日/周涨跌幅 |
| 布林带 | 5% | 波动区间位置 |
| 大盘走势 | 5% | 系统性风险 |
| 板块联动 | 3% | 行业趋势 |

### 评分与操作建议

| 加权总分 | 操作建议 | 操作量 |
|----------|----------|--------|
| ≥ +5.0 | 🟢 大力加仓 | 可用资金的40% |
| +3.0 ~ +5.0 | 🟢 正常加仓 | 可用资金的25% |
| +1.5 ~ +3.0 | 🟡 小仓加仓 | 可用资金的15% |
| -1.5 ~ +1.5 | ⚪ 持有观望 | 不操作 |
| -3.0 ~ -1.5 | 🟡 小仓减仓 | 机动仓位的15% |
| -5.0 ~ -3.0 | 🟠 正常减仓 | 机动仓位的25% |
| ≤ -5.0 | 🔴 大力减仓 | 机动仓位的40% |

### 持仓配置

| 股票 | 代码 | 核心仓位 | 机动仓位 |
|------|------|----------|----------|
| 铜陵有色 | 000630 | 60% | 40% |
| 紫金矿业 | 601899 | 67% | 33% |

## 策略回测工具

验证9维度加权评分策略在历史数据上的有效性。

### 使用方法

```bash
# 回测铜陵有色，过去1年（250个交易日）
python backtest.py --code 000630 --days 250

# 回测紫金矿业，过去6个月
python backtest.py --code 601899 --days 120

# 指定日期范围回测
python backtest.py --code 000630 --start 2024-01-01 --end 2024-12-01

# 指定初始资金和持仓
python backtest.py --code 000630 --cash 100000 --shares 5000 --cost 4.25

# 导出交易记录到CSV
python backtest.py --code 000630 --days 250 --export

# 显示完整交易明细
python backtest.py --code 000630 --days 250 --detail

# 同时回测多只股票
python backtest.py --code 000630,601899 --days 250
```

### 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `--code, -c` | 股票/ETF代码 | 必填 |
| `--days, -d` | 回测天数 | 250 |
| `--start, -s` | 开始日期 | - |
| `--end, -e` | 结束日期 | - |
| `--cash` | 初始资金 | 100000 |
| `--shares` | 初始持仓 | 0 |
| `--cost` | 持仓成本 | 0 |
| `--export` | 导出CSV | 否 |
| `--detail` | 显示完整记录 | 否 |

### 输出报告

1. **Summary（摘要）**
   - 收益对比：策略收益 vs 持有收益 vs 超额收益
   - 交易统计：次数、胜率、盈亏比
   - 风险指标：最大回撤、夏普比率、波动率
   - 策略评价：有效/一般/无效

2. **Detail（详细）**
   - 每笔交易的日期、操作、价格、数量、评分、原因
   - 可导出CSV文件用于进一步分析

## 注意事项

1. 本工具仅供参考，不构成投资建议
2. 投资有风险，入市需谨慎
3. 数据来源于akshare，可能存在延迟
4. 个股分析基于技术面，需结合基本面综合判断
5. 回测结果不代表未来收益
