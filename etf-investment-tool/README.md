# 投资分析工具

每日收盘后运行，给出次日投资操作建议。

**数据源：Baostock（完全免费，无需注册）**

## 功能概览

| 标的 | 分析方式 | 输出内容 |
|------|---------|---------|
| 紫金矿业 (601899) | 目标价分析 | 多档目标买入价，方便盘中看盘 |
| 铜陵有色 (000630) | 网格交易 | 次日具体操作计划（买/卖价格、股数） |

> 注：ETF 功能暂时禁用（Baostock 不支持 ETF 数据）

## 快速开始

```bash
cd etf-investment-tool
./run.sh
```

首次运行会自动创建虚拟环境并安装依赖。

## 输出示例

运行后会：
1. 在终端显示分析结果
2. 生成 HTML 报告到 `output/report_YYYY-MM-DD.html`

HTML 报告会自动在浏览器中打开。

## 目录结构

```
etf-investment-tool/
├── main.py              # 主程序入口
├── etf_analyzer.py      # ETF 定投分析
├── stock_analyzer.py    # 个股分析（紫金目标价 + 铜陵网格）
├── grid_trading.py      # 网格交易模块
├── html_report.py       # HTML 报告生成
├── data_source.py       # 数据获取层（Tushare + Baostock）
├── backtest.py          # 策略回测工具（评分/网格/动态目标价）
├── run.sh               # 一键运行脚本
├── requirements.txt     # Python 依赖
├── data/                # 持仓数据（git忽略）
│   └── grid_positions.json
└── output/              # 生成的报告（git忽略）
    └── report_YYYY-MM-DD.html
```

## 数据源

使用 **Baostock**，完全免费，无需注册：

```bash
pip install baostock
```

| 支持数据 | 说明 |
|----------|------|
| A股个股 | ✅ 日线、分钟线 |
| 指数 | ✅ 上证、深证、沪深300等 |
| ETF | ❌ 暂不支持 |

> 如需 ETF 数据，可后续添加 Tushare 支持。

## ETF 定投策略

### 目标价计算

```
基准价 = MA20×40% + MA60×40% + 月K低点×20%
目标价 = 基准价 × (1 - 折扣率)
```

### 折扣率规则

| RSI | 基础折扣 |
|-----|---------|
| < 30 | 2% (超卖) |
| < 50 | 4% (偏弱) |
| ≥ 50 | 6% (正常) |

均线/底部加成：每满足一项减 1% 折扣

### 买入建议

| 条件 | 建议 |
|------|------|
| 现价 ≤ 目标价 + 信号≥2 | 强烈买入 |
| 现价 ≤ 目标价 | 正常买入 |
| 现价 ≤ 目标价×1.05 | 减半买入 |
| 现价 > 目标价×1.05 | 暂缓买入 |

## 紫金矿业 - 目标价分析

给出三档目标买入价，方便盘中看盘：

| 档位 | 计算方式 | 说明 |
|------|---------|------|
| 保守 | 基准价×97% | 小幅回调即可买入 |
| 正常 | 基准价×93% | 标准买入位 |
| 激进 | 基准价×88% | 大跌后加仓机会 |

## 铜陵有色 - 网格交易

### 参数配置

| 参数 | 说明 |
|------|------|
| 中枢价格 | MA20×40% + MA60×40% + 月K低点×20% |
| 网格间距 | 基于 ATR 动态计算（约 3-4%） |
| 买入金额 | 动态网格（偏离越大买越多） |
| 卖出条件 | 涨回上一格 或 达到止盈位 |

### 持仓记录

网格交易状态保存在 `data/grid_positions.json`，包含：
- 每格买入价格、股数、日期
- 可用资金余额
- 交易历史

### 次日操作计划

每日分析后会给出：
- **买入计划**：若跌至 X 元，买入 Y 股
- **卖出计划**：若涨至 X 元，卖出 Y 股
- **止盈计划**：高于中枢 5% 时分批止盈

## 策略回测

### 基本用法

```bash
# 动态目标价策略（推荐）- 紫金矿业，最近500天
python backtest.py -c 601899 -s target -d 500

# 评分策略 - 紫金矿业，最近250天
python backtest.py -c 601899 -s score -d 250

# 网格交易策略 - 铜陵有色
python backtest.py -c 000630 -s grid -d 250 --grid-step 3.5
```

### 指定时间范围

```bash
# 回测 2023-01-01 到 2024-06-30
python backtest.py -c 601899 -s target --start 2023-01-01 --end 2024-06-30

# 回测 2022 全年
python backtest.py -c 601899 -s target --start 2022-01-01 --end 2022-12-31

# 从 2023-06-01 到今天
python backtest.py -c 601899 -s target --start 2023-06-01

# 最近300天（不指定日期时使用 -d）
python backtest.py -c 601899 -s target -d 300
```

### 回测其他股票

```bash
# 贵州茅台
python backtest.py -c 600519 -s target -d 500

# 五粮液
python backtest.py -c 000858 -s target -d 500

# 中国平安
python backtest.py -c 601318 -s target -d 500
```

### 调整策略参数

```bash
# 调整止盈止损比例
python backtest.py -c 601899 -s target --profit-target 0.15 --stop-loss 0.10

# 调整评分系数（默认0.5%/分）
python backtest.py -c 601899 -s target --score-factor 0.8

# 使用简单目标价（不用评分调整，用于对比测试）
python backtest.py -c 601899 -s target --simple-target

# 调整初始资金
python backtest.py -c 601899 -s target --cash 200000
```

### 导出数据

```bash
# 导出交易记录到 CSV
python backtest.py -c 601899 -s target -d 300 --export
```

### 回测参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `-c, --code` | 股票代码 | 必填 |
| `-s, --strategy` | 策略类型 (score/grid/target) | score |
| `-d, --days` | 回测天数（不指定日期时使用） | 250 |
| `--start` | 开始日期（YYYY-MM-DD） | - |
| `--end` | 结束日期（YYYY-MM-DD） | - |
| `--cash` | 初始资金 | 100000 |
| `--grid-step` | 网格间距(%) | 3.5 |
| `--profit-target` | 止盈比例 | 0.10 (10%) |
| `--stop-loss` | 止损比例 | 0.08 (8%) |
| `--score-factor` | 评分调整系数 | 0.5 (%/分) |
| `--simple-target` | 使用简单目标价 | - |
| `--export` | 导出CSV | - |

### 动态目标价策略

结合9维度加权评分动态调整目标价，是最完整的策略。

#### 策略逻辑

```
基础目标价 = MA20×40% + MA60×40% + 月K低点×20%
动态目标价 = 基础目标价 × (1 + 加权评分 × 0.5%)

买入条件：现价 ≤ 动态目标价
  - 评分越高 → 仓位越大（10%~40%）
  
卖出条件：
  - 止盈 +10%
  - 止损 -8%  
  - 技术面恶化（评分 ≤ -5）
```

#### 9维度加权评分

| 维度 | 权重 | 说明 |
|------|------|------|
| 均线系统 | 25% | 价格与MA5/MA30/MA60关系 |
| RSI | 15% | 超买超卖指标 |
| 成交量 | 15% | 量价配合 |
| 成本关系 | 12% | 当前盈亏比例 |
| MACD | 10% | 金叉/死叉信号 |
| 涨跌幅 | 10% | 日/周涨跌幅 |
| 布林带 | 5% | 价格在布林带中位置 |
| 大盘 | 5% | 大盘环境（简化） |
| 板块 | 3% | 板块强弱（简化） |

评分范围 -10 到 +10，用于：
1. **动态调整目标价**：评分高则目标价上调（更容易买入），评分低则目标价下调（等更低价格）
2. **决定买入仓位**：评分≥5买40%，评分≥3买30%，评分≥0买20%，评分<0买10%
3. **技术面卖出信号**：评分≤-5时提前卖出，避免更大亏损

## 注意事项

1. **仅供参考**：本工具输出的建议不构成投资建议
2. **数据延迟**：Tushare 免费版数据有延迟，建议收盘后运行
3. **持仓记录**：`data/` 目录中的数据请妥善保管
4. **Token 安全**：请勿将 Tushare Token 提交到公开仓库

## 回溯测试

消费行业
股票名称	代码	细分领域
贵州茅台	600519	高端白酒龙头
五粮液	000858	浓香型白酒龙头
伊利股份	600887	乳制品龙头
海天味业	603288	调味品龙头

科技/半导体行业
股票名称	代码	细分领域
中芯国际	688981	芯片制造龙头
北方华创	002371	半导体设备龙头
韦尔股份	603501	CIS芯片设计龙头
科大讯飞	002230	智能语音龙头
立讯精密	002475	消费电子精密制造龙头

新能源行业
股票名称	代码	细分领域
宁德时代	300750	动力电池全球龙头
比亚迪	002594	新能源汽车龙头
隆基绿能	601012	光伏龙头
阳光电源	300274	逆变器龙头
长江电力	600900	水电龙头

医药生物行业
股票名称	代码	细分领域
迈瑞医疗	300760	医疗器械龙头
恒瑞医药	600276	创新药龙头
药明康德	603259	CXO龙头
片仔癀	600436	中药龙头
爱尔眼科	300015	眼科医疗龙头

金融行业
股票名称	代码	细分领域
工商银行	601398	银行龙头（规模最大）
招商银行	600036	股份制银行龙头
中国平安	601318	综合金融龙头
中信证券	600030	证券龙头
中国人寿	601628	寿险龙头

高端制造/军工
股票名称	代码	细分领域
三一重工	600031	工程机械龙头
中航沈飞	600760	歼击机龙头
航发动力	600893	航空发动机龙头
工业富联	601138	AI服务器代工龙头
中国中车	601766	轨道交通龙头

人工智能/算力
股票名称	代码	细分领域
海康威视	002415	AI视觉龙头
中科曙光	603019	国产AI服务器龙头
紫光股份	000938	ICT设备龙头

汽车行业
股票名称	代码	细分领域
比亚迪	002594	新能源车龙头
长城汽车	601238	SUV/皮卡龙头
福耀玻璃	600660	汽车玻璃龙头
华域汽车	600741	汽车零部件龙头

家电行业
股票名称	代码	细分领域
美的集团	000333	综合家电龙头
格力电器	000651	空调龙头
海尔智家	600690	白电龙头

资源/周期行业
股票名称	代码	细分领域
中国神华	601088	煤炭龙头
紫金矿业	601899	有色金属龙头
中国石油	601857	石油龙头
宝钢股份	600019	钢铁龙头
万华化学	600309	化工龙头

通信行业
股票名称	代码	细分领域
中国移动	600941	电信运营商龙头
中兴通讯	000063	通信设备龙头
亿联网络	300628	统一通信龙头
